<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoneyTrack - Manajemen Keuangan Mahasiswa</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary: #6C63FF;
            --primary-dark: #5a52d5;
            --secondary: #4ECDC4;
            --accent: #FF6B6B;
            --success: #4CAF50;
            --warning: #FFC107;
            --danger: #F44336;
            --light: #F8F9FA;
            --dark: #343A40;
            --gray: #6C757D;
            --gray-light: #E9ECEF;
            --gradient: linear-gradient(135deg, #6C63FF 0%, #4ECDC4 100%);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --radius: 12px;
            --transition: all 0.3s ease;
        }

        .dark-mode {
            --light: #1A1A2E;
            --dark: #F8F9FA;
            --gray-light: #16213E;
            --gray: #A0A0A0;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
            transition: var(--transition);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Auth Pages */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient);
            padding: 20px;
        }

        .auth-card {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 450px;
            padding: 40px;
            transition: var(--transition);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h1 {
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 10px;
        }

        .auth-header p {
            color: var(--gray);
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            font-size: 16px;
            transition: var(--transition);
            background-color: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.1);
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--gray-light);
            color: var(--dark);
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        .auth-footer {
            text-align: center;
            margin-top: 20px;
        }

        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        /* Dashboard Layout */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: white;
            box-shadow: var(--shadow);
            transition: var(--transition);
            z-index: 100;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-header h2 {
            color: var(--primary);
            font-size: 20px;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--dark);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }

        .menu-item:hover, .menu-item.active {
            background-color: rgba(108, 99, 255, 0.1);
            border-left-color: var(--primary);
            color: var(--primary);
        }

        .menu-item i {
            margin-right: 10px;
            font-size: 18px;
        }

        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
            transition: var(--transition);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .toggle-sidebar, .toggle-dark {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--dark);
            transition: var(--transition);
        }

        .toggle-dark:hover, .toggle-sidebar:hover {
            color: var(--primary);
        }

        /* Cards */
        .card {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            margin-bottom: 20px;
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray-light);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
        }

        .card-actions {
            display: flex;
            gap: 10px;
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            display: flex;
            align-items: center;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 24px;
            color: white;
        }

        .stat-income .stat-icon {
            background: var(--success);
        }

        .stat-expense .stat-icon {
            background: var(--danger);
        }

        .stat-balance .stat-icon {
            background: var(--primary);
        }

        .stat-limit .stat-icon {
            background: var(--warning);
        }

        .stat-info h3 {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .stat-info p {
            font-size: 24px;
            font-weight: 600;
        }

        /* Progress Bar */
        .progress-container {
            margin-top: 10px;
        }

        .progress-bar {
            height: 8px;
            background-color: var(--gray-light);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 12px;
            color: var(--gray);
        }

        /* Forms */
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
        }

        .transaction-form {
            display: none;
        }

        .transaction-form.active {
            display: block;
        }

        .form-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--gray-light);
        }

        .form-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: var(--transition);
        }

        .form-tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: 500;
        }

        /* Tables */
        .table-responsive {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--gray-light);
        }

        .data-table th {
            background-color: rgba(108, 99, 255, 0.05);
            font-weight: 600;
            color: var(--dark);
        }

        .data-table tr:hover {
            background-color: rgba(108, 99, 255, 0.03);
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-income {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success);
        }

        .badge-expense {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger);
        }

        /* Charts */
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-light);
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: var(--transition);
        }

        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: 500;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .toast {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            padding: 15px 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            max-width: 350px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: white;
            font-size: 14px;
        }

        .toast-success .toast-icon {
            background: var(--success);
        }

        .toast-error .toast-icon {
            background: var(--danger);
        }

        .toast-warning .toast-icon {
            background: var(--warning);
        }

        .toast-content {
            flex: 1;
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: var(--gray);
        }

        /* Category Management */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .category-card {
            background: white;
            border-radius: var(--radius);
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .category-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .category-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .category-actions {
            display: flex;
            gap: 5px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid rgba(108, 99, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid var(--primary);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
            }

            .categories-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Dark Mode */
        body.dark-mode {
            background-color: var(--light);
            color: var(--dark);
        }

        body.dark-mode .auth-card,
        body.dark-mode .sidebar,
        body.dark-mode .card,
        body.dark-mode .stat-card,
        body.dark-mode .toast,
        body.dark-mode .modal-content,
        body.dark-mode .category-card {
            background-color: var(--gray-light);
            color: var(--dark);
        }

        body.dark-mode .form-control {
            background-color: var(--light);
            color: var(--dark);
            border-color: var(--gray);
        }

        body.dark-mode .data-table th {
            background-color: rgba(108, 99, 255, 0.1);
        }

        body.dark-mode .menu-item {
            color: var(--dark);
        }

        body.dark-mode .card-header {
            border-bottom-color: var(--gray);
        }

        body.dark-mode .progress-bar {
            background-color: var(--gray);
        }
    </style>
</head>
<body>
    <!-- Auth Pages -->
    <div id="auth-page" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h1>MoneyTrack</h1>
                <p>Kelola keuangan mahasiswa dengan mudah</p>
            </div>
            <div id="login-form">
                <div class="form-group">
                    <label class="form-label" for="login-email">Email atau Username</label>
                    <input type="text" id="login-email" class="form-control" placeholder="Masukkan email atau username">
                </div>
                <div class="form-group">
                    <label class="form-label" for="login-password">Password</label>
                    <input type="password" id="login-password" class="form-control" placeholder="Masukkan password">
                </div>
                <button class="btn" id="login-btn">Masuk</button>
                <div class="auth-footer">
                    <p>Belum punya akun? <a href="#" id="show-register">Daftar di sini</a></p>
                </div>
            </div>
            <div id="register-form" style="display: none;">
                <div class="form-group">
                    <label class="form-label" for="register-name">Nama Lengkap</label>
                    <input type="text" id="register-name" class="form-control" placeholder="Masukkan nama lengkap">
                </div>
                <div class="form-group">
                    <label class="form-label" for="register-username">Username</label>
                    <input type="text" id="register-username" class="form-control" placeholder="Masukkan username">
                </div>
                <div class="form-group">
                    <label class="form-label" for="register-email">Email</label>
                    <input type="email" id="register-email" class="form-control" placeholder="Masukkan email">
                </div>
                <div class="form-group">
                    <label class="form-label" for="register-password">Password</label>
                    <input type="password" id="register-password" class="form-control" placeholder="Masukkan password">
                </div>
                <div class="form-group">
                    <label class="form-label" for="register-confirm">Konfirmasi Password</label>
                    <input type="password" id="register-confirm" class="form-control" placeholder="Konfirmasi password">
                </div>
                <button class="btn" id="register-btn">Daftar</button>
                <div class="auth-footer">
                    <p>Sudah punya akun? <a href="#" id="show-login">Masuk di sini</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" style="display: none;">
        <div class="dashboard-container">
            <!-- Sidebar -->
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h2>MoneyTrack</h2>
                    <button class="toggle-sidebar" id="toggle-sidebar">
                        <i>≡</i>
                    </button>
                </div>
                <div class="sidebar-menu">
                    <a href="#" class="menu-item active" data-page="dashboard-page">
                        <i>📊</i> Dashboard
                    </a>
                    <a href="#" class="menu-item" data-page="transactions-page">
                        <i>💸</i> Transaksi
                    </a>
                    <a href="#" class="menu-item" data-page="reports-page">
                        <i>📈</i> Laporan
                    </a>
                    <a href="#" class="menu-item" data-page="settings-page">
                        <i>⚙️</i> Pengaturan
                    </a>
                    <a href="#" class="menu-item" id="logout-btn">
                        <i>🚪</i> Keluar
                    </a>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <div class="header">
                    <h1 id="page-title">Dashboard</h1>
                    <div class="header-actions">
                        <button class="toggle-dark" id="toggle-dark">
                            <i>🌙</i>
                        </button>
                        <div class="user-info">
                            <div class="user-avatar" id="user-avatar">U</div>
                            <span id="user-name">User</span>
                        </div>
                    </div>
                </div>

                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page-content">
                    <div class="stats-grid">
                        <div class="stat-card stat-income">
                            <div class="stat-icon">+</div>
                            <div class="stat-info">
                                <h3>Total Pemasukan</h3>
                                <p id="total-income">Rp 0</p>
                            </div>
                        </div>
                        <div class="stat-card stat-expense">
                            <div class="stat-icon">-</div>
                            <div class="stat-info">
                                <h3>Total Pengeluaran</h3>
                                <p id="total-expense">Rp 0</p>
                            </div>
                        </div>
                        <div class="stat-card stat-balance">
                            <div class="stat-icon">=</div>
                            <div class="stat-info">
                                <h3>Saldo</h3>
                                <p id="total-balance">Rp 0</p>
                            </div>
                        </div>
                        <div class="stat-card stat-limit">
                            <div class="stat-icon">!</div>
                            <div class="stat-info">
                                <h3>Limit Harian</h3>
                                <p id="daily-limit">Rp 0</p>
                                <div class="progress-container">
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="limit-progress" style="width: 0%"></div>
                                    </div>
                                    <div class="progress-info">
                                        <span id="limit-used">Rp 0</span>
                                        <span id="limit-remaining">Tersisa: Rp 0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Transaksi Terbaru</div>
                            <div class="card-actions">
                                <button class="btn" id="add-income-btn">Tambah Pemasukan</button>
                                <button class="btn btn-secondary" id="add-expense-btn">Tambah Pengeluaran</button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>Kategori</th>
                                        <th>Keterangan</th>
                                        <th>Jumlah</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-transactions">
                                    <!-- Recent transactions will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Grafik Pengeluaran Bulan Ini</div>
                        </div>
                        <div class="chart-container">
                            <canvas id="expense-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Transactions Page -->
                <div id="transactions-page" class="page-content" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Tambah Transaksi</div>
                        </div>
                        <div class="form-tabs">
                            <div class="form-tab active" data-form="income-form">Pemasukan</div>
                            <div class="form-tab" data-form="expense-form">Pengeluaran</div>
                        </div>
                        
                        <!-- Income Form -->
                        <div id="income-form" class="transaction-form active">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="income-amount">Jumlah</label>
                                    <input type="number" id="income-amount" class="form-control" placeholder="Masukkan jumlah">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="income-source">Sumber</label>
                                    <select id="income-source" class="form-control">
                                        <option value="gaji">Gaji</option>
                                        <option value="uang_saku">Uang Saku</option>
                                        <option value="freelance">Freelance</option>
                                        <option value="hibah">Hibah/Beasiswa</option>
                                        <option value="lainnya">Lainnya</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="income-date">Tanggal</label>
                                    <input type="date" id="income-date" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="income-description">Keterangan</label>
                                <textarea id="income-description" class="form-control" placeholder="Tambahkan keterangan (opsional)"></textarea>
                            </div>
                            <button class="btn" id="save-income">Simpan Pemasukan</button>
                        </div>
                        
                        <!-- Expense Form -->
                        <div id="expense-form" class="transaction-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="expense-amount">Jumlah</label>
                                    <input type="number" id="expense-amount" class="form-control" placeholder="Masukkan jumlah">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="expense-category">Kategori</label>
                                    <select id="expense-category" class="form-control">
                                        <!-- Categories will be populated dynamically -->
                                    </select>
                                    <button type="button" class="btn btn-secondary btn-sm" style="margin-top: 5px; width: auto;" id="manage-categories-btn">
                                        Kelola Kategori
                                    </button>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="expense-date">Tanggal</label>
                                    <input type="date" id="expense-date" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="expense-description">Keterangan Detail</label>
                                <textarea id="expense-description" class="form-control" placeholder="Tambahkan keterangan detail"></textarea>
                            </div>
                            <button class="btn" id="save-expense">Simpan Pengeluaran</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Riwayat Transaksi</div>
                            <div class="card-actions">
                                <input type="text" id="search-transactions" class="form-control" placeholder="Cari transaksi...">
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>Tipe</th>
                                        <th>Kategori</th>
                                        <th>Keterangan</th>
                                        <th>Jumlah</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="all-transactions">
                                    <!-- All transactions will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Reports Page -->
                <div id="reports-page" class="page-content" style="display: none;">
                    <div class="tabs">
                        <div class="tab active" data-period="daily">Harian</div>
                        <div class="tab" data-period="weekly">Mingguan</div>
                        <div class="tab" data-period="monthly">Bulanan</div>
                        <div class="tab" data-period="yearly">Tahunan</div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title" id="report-title">Laporan Harian</div>
                            <div class="card-actions">
                                <button class="btn" id="export-pdf">Cetak PDF</button>
                            </div>
                        </div>

                        <div class="loading-spinner" id="pdf-loading">
                            <div class="spinner"></div>
                            <p>Menyiapkan laporan PDF...</p>
                        </div>

                        <!-- Daily Report -->
                        <div id="daily-report" class="tab-content active">
                            <div class="stats-grid">
                                <div class="stat-card stat-income">
                                    <div class="stat-icon">+</div>
                                    <div class="stat-info">
                                        <h3>Pemasukan Hari Ini</h3>
                                        <p id="daily-income">Rp 0</p>
                                    </div>
                                </div>
                                <div class="stat-card stat-expense">
                                    <div class="stat-icon">-</div>
                                    <div class="stat-info">
                                        <h3>Pengeluaran Hari Ini</h3>
                                        <p id="daily-expense">Rp 0</p>
                                    </div>
                                </div>
                                <div class="stat-card stat-balance">
                                    <div class="stat-icon">=</div>
                                    <div class="stat-info">
                                        <h3>Saldo Hari Ini</h3>
                                        <p id="daily-balance">Rp 0</p>
                                    </div>
                                </div>
                            </div>

                            <div class="chart-container">
                                <canvas id="daily-chart"></canvas>
                            </div>

                            <div class="table-responsive">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Waktu</th>
                                            <th>Tipe</th>
                                            <th>Kategori</th>
                                            <th>Keterangan</th>
                                            <th>Jumlah</th>
                                        </tr>
                                    </thead>
                                    <tbody id="daily-transactions">
                                        <!-- Daily transactions will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Weekly Report -->
                        <div id="weekly-report" class="tab-content">
                            <div class="stats-grid">
                                <div class="stat-card stat-income">
                                    <div class="stat-icon">+</div>
                                    <div class="stat-info">
                                        <h3>Pemasukan Minggu Ini</h3>
                                        <p id="weekly-income">Rp 0</p>
                                    </div>
                                </div>
                                <div class="stat-card stat-expense">
                                    <div class="stat-icon">-</div>
                                    <div class="stat-info">
                                        <h3>Pengeluaran Minggu Ini</h3>
                                        <p id="weekly-expense">Rp 0</p>
                                    </div>
                                </div>
                                <div class="stat-card stat-balance">
                                    <div class="stat-icon">=</div>
                                    <div class="stat-info">
                                        <h3>Saldo Minggu Ini</h3>
                                        <p id="weekly-balance">Rp 0</p>
                                    </div>
                                </div>
                            </div>

                            <div class="chart-container">
                                <canvas id="weekly-chart"></canvas>
                            </div>

                            <div class="table-responsive">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Tanggal</th>
                                            <th>Tipe</th>
                                            <th>Kategori</th>
                                            <th>Keterangan</th>
                                            <th>Jumlah</th>
                                        </tr>
                                    </thead>
                                    <tbody id="weekly-transactions">
                                        <!-- Weekly transactions will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Monthly Report -->
                        <div id="monthly-report" class="tab-content">
                            <div class="stats-grid">
                                <div class="stat-card stat-income">
                                    <div class="stat-icon">+</div>
                                    <div class="stat-info">
                                        <h3>Pemasukan Bulan Ini</h3>
                                        <p id="monthly-income">Rp 0</p>
                                    </div>
                                </div>
                                <div class="stat-card stat-expense">
                                    <div class="stat-icon">-</div>
                                    <div class="stat-info">
                                        <h3>Pengeluaran Bulan Ini</h3>
                                        <p id="monthly-expense">Rp 0</p>
                                    </div>
                                </div>
                                <div class="stat-card stat-balance">
                                    <div class="stat-icon">=</div>
                                    <div class="stat-info">
                                        <h3>Saldo Bulan Ini</h3>
                                        <p id="monthly-balance">Rp 0</p>
                                    </div>
                                </div>
                            </div>

                            <div class="chart-container">
                                <canvas id="monthly-chart"></canvas>
                            </div>

                            <div class="table-responsive">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Tanggal</th>
                                            <th>Tipe</th>
                                            <th>Kategori</th>
                                            <th>Keterangan</th>
                                            <th>Jumlah</th>
                                        </tr>
                                    </thead>
                                    <tbody id="monthly-transactions">
                                        <!-- Monthly transactions will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Yearly Report -->
                        <div id="yearly-report" class="tab-content">
                            <div class="stats-grid">
                                <div class="stat-card stat-income">
                                    <div class="stat-icon">+</div>
                                    <div class="stat-info">
                                        <h3>Pemasukan Tahun Ini</h3>
                                        <p id="yearly-income">Rp 0</p>
                                    </div>
                                </div>
                                <div class="stat-card stat-expense">
                                    <div class="stat-icon">-</div>
                                    <div class="stat-info">
                                        <h3>Pengeluaran Tahun Ini</h3>
                                        <p id="yearly-expense">Rp 0</p>
                                    </div>
                                </div>
                                <div class="stat-card stat-balance">
                                    <div class="stat-icon">=</div>
                                    <div class="stat-info">
                                        <h3>Saldo Tahun Ini</h3>
                                        <p id="yearly-balance">Rp 0</p>
                                    </div>
                                </div>
                            </div>

                            <div class="chart-container">
                                <canvas id="yearly-chart"></canvas>
                            </div>

                            <div class="table-responsive">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Tanggal</th>
                                            <th>Tipe</th>
                                            <th>Kategori</th>
                                            <th>Keterangan</th>
                                            <th>Jumlah</th>
                                        </tr>
                                    </thead>
                                    <tbody id="yearly-transactions">
                                        <!-- Yearly transactions will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div id="settings-page" class="page-content" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Pengaturan Limit Pengeluaran</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="daily-limit-input">Limit Pengeluaran Harian</label>
                            <input type="number" id="daily-limit-input" class="form-control" placeholder="Masukkan limit harian">
                        </div>
                        <button class="btn" id="save-limit">Simpan Limit</button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Kelola Kategori Pengeluaran</div>
                            <div class="card-actions">
                                <button class="btn" id="add-category-btn">Tambah Kategori</button>
                            </div>
                        </div>
                        <div class="categories-grid" id="categories-container">
                            <!-- Categories will be populated here -->
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Profil Pengguna</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="profile-name">Nama Lengkap</label>
                            <input type="text" id="profile-name" class="form-control" placeholder="Masukkan nama lengkap">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="profile-username">Username</label>
                            <input type="text" id="profile-username" class="form-control" placeholder="Masukkan username">
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="profile-email">Email</label>
                            <input type="email" id="profile-email" class="form-control" placeholder="Masukkan email">
                        </div>
                        <button class="btn" id="save-profile">Simpan Profil</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal" id="category-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="category-modal-title">Tambah Kategori Baru</div>
                <button class="modal-close" id="category-modal-close">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label" for="category-name">Nama Kategori</label>
                <input type="text" id="category-name" class="form-control" placeholder="Masukkan nama kategori">
            </div>
            <div class="form-group">
                <label class="form-label" for="category-color">Warna Kategori</label>
                <input type="color" id="category-color" class="form-control" value="#6C63FF">
            </div>
            <button class="btn" id="save-category">Simpan Kategori</button>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <script>
        // Data Storage Functions
        const Storage = {
            // User Management
            getUsers: () => JSON.parse(localStorage.getItem('users')) || [],
            setUsers: (users) => localStorage.setItem('users', JSON.stringify(users)),
            
            // Current User
            getCurrentUser: () => JSON.parse(localStorage.getItem('currentUser')),
            setCurrentUser: (user) => localStorage.setItem('currentUser', JSON.stringify(user)),
            clearCurrentUser: () => localStorage.removeItem('currentUser'),
            
            // Transactions
            getTransactions: () => JSON.parse(localStorage.getItem('transactions')) || [],
            setTransactions: (transactions) => localStorage.setItem('transactions', JSON.stringify(transactions)),
            
            // Settings
            getSettings: () => JSON.parse(localStorage.getItem('settings')) || { dailyLimit: 0 },
            setSettings: (settings) => localStorage.setItem('settings', JSON.stringify(settings)),
            
            // Categories
            getCategories: () => {
                const defaultCategories = [
                    { id: 'makanan', name: 'Makanan', color: '#FF6B6B' },
                    { id: 'transport', name: 'Transportasi', color: '#4ECDC4' },
                    { id: 'pendidikan', name: 'Pendidikan', color: '#45B7D1' },
                    { id: 'hiburan', name: 'Hiburan', color: '#96CEB4' },
                    { id: 'kesehatan', name: 'Kesehatan', color: '#FECA57' },
                    { id: 'lainnya', name: 'Lainnya', color: '#FF9FF3' }
                ];
                
                const customCategories = JSON.parse(localStorage.getItem('categories')) || [];
                return [...defaultCategories, ...customCategories];
            },
            
            setCategories: (categories) => {
                // Only save custom categories, not default ones
                const customCategories = categories.filter(cat => 
                    !['makanan', 'transport', 'pendidikan', 'hiburan', 'kesehatan', 'lainnya'].includes(cat.id)
                );
                localStorage.setItem('categories', JSON.stringify(customCategories));
            },
            
            addCategory: (category) => {
                const categories = Storage.getCategories();
                // Generate unique ID
                category.id = 'custom_' + Date.now().toString();
                categories.push(category);
                Storage.setCategories(categories);
                return category;
            },
            
            updateCategory: (id, updatedCategory) => {
                const categories = Storage.getCategories();
                const index = categories.findIndex(cat => cat.id === id);
                if (index !== -1) {
                    categories[index] = { ...categories[index], ...updatedCategory };
                    Storage.setCategories(categories);
                }
            },
            
            deleteCategory: (id) => {
                // Don't allow deleting default categories
                if (['makanan', 'transport', 'pendidikan', 'hiburan', 'kesehatan', 'lainnya'].includes(id)) {
                    return false;
                }
                
                const categories = Storage.getCategories();
                const filteredCategories = categories.filter(cat => cat.id !== id);
                Storage.setCategories(filteredCategories);
                
                // Also update transactions that use this category to "lainnya"
                const transactions = Storage.getTransactions();
                const updatedTransactions = transactions.map(transaction => {
                    if (transaction.category === id) {
                        return { ...transaction, category: 'lainnya' };
                    }
                    return transaction;
                });
                Storage.setTransactions(updatedTransactions);
                
                return true;
            }
        };

        // Utility Functions
        const Utils = {
            formatCurrency: (amount) => {
                return new Intl.NumberFormat('id-ID', {
                    style: 'currency',
                    currency: 'IDR',
                    minimumFractionDigits: 0
                }).format(amount);
            },
            
            formatDate: (dateString) => {
                const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
                return new Date(dateString).toLocaleDateString('id-ID', options);
            },
            
            formatDateLong: (dateString) => {
                const options = { day: 'numeric', month: 'long', year: 'numeric' };
                return new Date(dateString).toLocaleDateString('id-ID', options);
            },
            
            showToast: (message, type = 'success') => {
                const toastContainer = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                toast.innerHTML = `
                    <div class="toast-icon">${type === 'success' ? '✓' : type === 'error' ? '✕' : '!'}</div>
                    <div class="toast-content">${message}</div>
                    <button class="toast-close">×</button>
                `;
                
                toastContainer.appendChild(toast);
                
                // Show toast
                setTimeout(() => toast.classList.add('show'), 100);
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 5000);
                
                // Close button
                toast.querySelector('.toast-close').addEventListener('click', () => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                });
            },
            
            validateEmail: (email) => {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            },
            
            validatePassword: (password) => {
                return password.length >= 6;
            },
            
            getPeriodText: (period) => {
                const texts = {
                    'daily': 'Harian',
                    'weekly': 'Mingguan',
                    'monthly': 'Bulanan',
                    'yearly': 'Tahunan'
                };
                return texts[period] || period;
            },
            
            getPeriodDateRange: (period) => {
                const now = new Date();
                let startDate, endDate;
                
                switch (period) {
                    case 'daily':
                        startDate = new Date(now);
                        endDate = new Date(now);
                        break;
                    case 'weekly':
                        startDate = new Date(now);
                        startDate.setDate(now.getDate() - 6);
                        endDate = new Date(now);
                        break;
                    case 'monthly':
                        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                        endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                        break;
                    case 'yearly':
                        startDate = new Date(now.getFullYear(), 0, 1);
                        endDate = new Date(now.getFullYear(), 11, 31);
                        break;
                    default:
                        startDate = new Date(now);
                        endDate = new Date(now);
                }
                
                return {
                    start: startDate,
                    end: endDate
                };
            }
        };

        // Authentication Functions
        const Auth = {
            login: (email, password) => {
                const users = Storage.getUsers();
                const user = users.find(u => 
                    (u.email === email || u.username === email) && u.password === password
                );
                
                if (user) {
                    Storage.setCurrentUser(user);
                    return { success: true, user };
                } else {
                    return { success: false, message: 'Email/username atau password salah' };
                }
            },
            
            register: (name, username, email, password, confirmPassword) => {
                // Validation
                if (!name || !username || !email || !password || !confirmPassword) {
                    return { success: false, message: 'Semua field harus diisi' };
                }
                
                if (!Utils.validateEmail(email)) {
                    return { success: false, message: 'Format email tidak valid' };
                }
                
                if (!Utils.validatePassword(password)) {
                    return { success: false, message: 'Password harus minimal 6 karakter' };
                }
                
                if (password !== confirmPassword) {
                    return { success: false, message: 'Konfirmasi password tidak cocok' };
                }
                
                const users = Storage.getUsers();
                
                // Check if email or username already exists
                if (users.find(u => u.email === email)) {
                    return { success: false, message: 'Email sudah terdaftar' };
                }
                
                if (users.find(u => u.username === username)) {
                    return { success: false, message: 'Username sudah terdaftar' };
                }
                
                // Create new user
                const newUser = {
                    id: Date.now().toString(),
                    name,
                    username,
                    email,
                    password,
                    createdAt: new Date().toISOString()
                };
                
                users.push(newUser);
                Storage.setUsers(users);
                Storage.setCurrentUser(newUser);
                
                return { success: true, user: newUser };
            },
            
            logout: () => {
                Storage.clearCurrentUser();
                window.location.reload();
            }
        };

        // Transaction Functions
        const Transactions = {
            add: (type, amount, category, date, description) => {
                const transactions = Storage.getTransactions();
                const currentUser = Storage.getCurrentUser();
                
                const newTransaction = {
                    id: Date.now().toString(),
                    userId: currentUser.id,
                    type,
                    amount: parseInt(amount),
                    category,
                    date,
                    description,
                    createdAt: new Date().toISOString()
                };
                
                transactions.push(newTransaction);
                Storage.setTransactions(transactions);
                
                return newTransaction;
            },
            
            getUserTransactions: () => {
                const transactions = Storage.getTransactions();
                const currentUser = Storage.getCurrentUser();
                
                return transactions.filter(t => t.userId === currentUser.id);
            },
            
            getByPeriod: (period) => {
                const transactions = Transactions.getUserTransactions();
                const now = new Date();
                
                switch (period) {
                    case 'daily':
                        const today = now.toISOString().split('T')[0];
                        return transactions.filter(t => t.date === today);
                    case 'weekly':
                        const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        return transactions.filter(t => new Date(t.date) >= oneWeekAgo);
                    case 'monthly':
                        const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
                        return transactions.filter(t => new Date(t.date) >= startOfMonth);
                    case 'yearly':
                        const startOfYear = new Date(now.getFullYear(), 0, 1);
                        return transactions.filter(t => new Date(t.date) >= startOfYear);
                    default:
                        return transactions;
                }
            },
            
            getStats: (period = 'all') => {
                const transactions = period === 'all' 
                    ? Transactions.getUserTransactions()
                    : Transactions.getByPeriod(period);
                
                const income = transactions
                    .filter(t => t.type === 'income')
                    .reduce((sum, t) => sum + t.amount, 0);
                    
                const expense = transactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);
                    
                return {
                    income,
                    expense,
                    balance: income - expense
                };
            },
            
            delete: (id) => {
                let transactions = Storage.getTransactions();
                transactions = transactions.filter(t => t.id !== id);
                Storage.setTransactions(transactions);
            }
        };

        // Settings Functions
        const Settings = {
            getDailyLimit: () => {
                const settings = Storage.getSettings();
                return settings.dailyLimit || 0;
            },
            
            setDailyLimit: (limit) => {
                const settings = Storage.getSettings();
                settings.dailyLimit = parseInt(limit);
                Storage.setSettings(settings);
            },
            
            checkLimit: () => {
                const limit = Settings.getDailyLimit();
                if (limit === 0) return { withinLimit: true };
                
                const todayTransactions = Transactions.getByPeriod('daily');
                const todayExpense = todayTransactions
                    .filter(t => t.type === 'expense')
                    .reduce((sum, t) => sum + t.amount, 0);
                    
                const percentage = (todayExpense / limit) * 100;
                
                return {
                    withinLimit: todayExpense <= limit,
                    todayExpense,
                    limit,
                    percentage: Math.min(percentage, 100)
                };
            }
        };

        // Category Functions
        const Categories = {
            loadCategoriesToSelect: () => {
                const categories = Storage.getCategories();
                const select = document.getElementById('expense-category');
                select.innerHTML = '';
                
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    select.appendChild(option);
                });
            },
            
            renderCategories: () => {
                const categories = Storage.getCategories();
                const container = document.getElementById('categories-container');
                container.innerHTML = '';
                
                categories.forEach(category => {
                    const isDefault = ['makanan', 'transport', 'pendidikan', 'hiburan', 'kesehatan', 'lainnya'].includes(category.id);
                    
                    const card = document.createElement('div');
                    card.className = 'category-card';
                    card.innerHTML = `
                        <div class="category-info">
                            <div class="category-color" style="background-color: ${category.color}"></div>
                            <span>${category.name}</span>
                        </div>
                        <div class="category-actions">
                            ${!isDefault ? `
                                <button class="btn btn-sm btn-secondary edit-category" data-id="${category.id}">Edit</button>
                                <button class="btn btn-sm btn-danger delete-category" data-id="${category.id}">Hapus</button>
                            ` : ''}
                        </div>
                    `;
                    container.appendChild(card);
                });
                
                // Add event listeners
                document.querySelectorAll('.edit-category').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const categoryId = e.target.getAttribute('data-id');
                        Categories.openEditModal(categoryId);
                    });
                });
                
                document.querySelectorAll('.delete-category').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const categoryId = e.target.getAttribute('data-id');
                        Categories.deleteCategory(categoryId);
                    });
                });
            },
            
            openAddModal: () => {
                document.getElementById('category-modal-title').textContent = 'Tambah Kategori Baru';
                document.getElementById('category-name').value = '';
                document.getElementById('category-color').value = '#6C63FF';
                document.getElementById('save-category').setAttribute('data-mode', 'add');
                document.getElementById('category-modal').classList.add('show');
            },
            
            openEditModal: (categoryId) => {
                const categories = Storage.getCategories();
                const category = categories.find(cat => cat.id === categoryId);
                
                if (category) {
                    document.getElementById('category-modal-title').textContent = 'Edit Kategori';
                    document.getElementById('category-name').value = category.name;
                    document.getElementById('category-color').value = category.color;
                    document.getElementById('save-category').setAttribute('data-mode', 'edit');
                    document.getElementById('save-category').setAttribute('data-id', categoryId);
                    document.getElementById('category-modal').classList.add('show');
                }
            },
            
            saveCategory: () => {
                const mode = document.getElementById('save-category').getAttribute('data-mode');
                const name = document.getElementById('category-name').value.trim();
                const color = document.getElementById('category-color').value;
                
                if (!name) {
                    Utils.showToast('Nama kategori harus diisi', 'error');
                    return;
                }
                
                if (mode === 'add') {
                    const newCategory = { name, color };
                    Storage.addCategory(newCategory);
                    Utils.showToast('Kategori berhasil ditambahkan', 'success');
                } else {
                    const categoryId = document.getElementById('save-category').getAttribute('data-id');
                    Storage.updateCategory(categoryId, { name, color });
                    Utils.showToast('Kategori berhasil diperbarui', 'success');
                }
                
                Categories.closeModal();
                Categories.loadCategoriesToSelect();
                Categories.renderCategories();
            },
            
            deleteCategory: (categoryId) => {
                if (confirm('Apakah Anda yakin ingin menghapus kategori ini? Transaksi yang menggunakan kategori ini akan dipindahkan ke kategori "Lainnya".')) {
                    const success = Storage.deleteCategory(categoryId);
                    if (success) {
                        Utils.showToast('Kategori berhasil dihapus', 'success');
                        Categories.loadCategoriesToSelect();
                        Categories.renderCategories();
                        // Refresh transactions page if open
                        if (document.getElementById('transactions-page').style.display !== 'none') {
                            UI.updateTransactions();
                        }
                    } else {
                        Utils.showToast('Kategori default tidak dapat dihapus', 'error');
                    }
                }
            },
            
            closeModal: () => {
                document.getElementById('category-modal').classList.remove('show');
            }
        };

        // PDF Export Functions
        const PDFExport = {
            generatePDF: async (period) => {
                // Show loading
                document.getElementById('pdf-loading').style.display = 'block';
                
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    // Get data for the selected period
                    const transactions = Transactions.getByPeriod(period);
                    const stats = Transactions.getStats(period);
                    const currentUser = Storage.getCurrentUser();
                    const periodText = Utils.getPeriodText(period);
                    const dateRange = Utils.getPeriodDateRange(period);
                    const categories = Storage.getCategories();
                    
                    // Set document properties
                    doc.setProperties({
                        title: `Laporan Keuangan ${periodText} - MoneyTrack`,
                        subject: `Laporan keuangan periode ${periodText}`,
                        author: 'MoneyTrack',
                        creator: currentUser.name
                    });
                    
                    // Add header
                    doc.setFontSize(20);
                    doc.setTextColor(108, 99, 255);
                    doc.text('MoneyTrack', 105, 20, { align: 'center' });
                    
                    doc.setFontSize(16);
                    doc.setTextColor(0, 0, 0);
                    doc.text(`Laporan Keuangan ${periodText}`, 105, 30, { align: 'center' });
                    
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    const dateText = `Periode: ${Utils.formatDate(dateRange.start)} - ${Utils.formatDate(dateRange.end)}`;
                    doc.text(dateText, 105, 37, { align: 'center' });
                    
                    // User info
                    doc.setFontSize(10);
                    doc.text(`Nama: ${currentUser.name}`, 20, 47);
                    doc.text(`Email: ${currentUser.email}`, 20, 52);
                    doc.text(`Tanggal Cetak: ${Utils.formatDate(new Date().toISOString())}`, 20, 57);
                    
                    // Summary section
                    let yPos = 70;
                    doc.setFontSize(14);
                    doc.setTextColor(0, 0, 0);
                    doc.text('Ringkasan Keuangan', 20, yPos);
                    
                    yPos += 10;
                    doc.setFontSize(10);
                    
                    // Summary table
                    const summaryData = [
                        ['Pemasukan', Utils.formatCurrency(stats.income)],
                        ['Pengeluaran', Utils.formatCurrency(stats.expense)],
                        ['Saldo', Utils.formatCurrency(stats.balance)]
                    ];
                    
                    doc.autoTable({
                        startY: yPos,
                        head: [['Kategori', 'Jumlah']],
                        body: summaryData,
                        theme: 'grid',
                        headStyles: {
                            fillColor: [108, 99, 255],
                            textColor: [255, 255, 255],
                            fontStyle: 'bold'
                        },
                        styles: {
                            fontSize: 10,
                            cellPadding: 5
                        },
                        columnStyles: {
                            1: { halign: 'right' }
                        }
                    });
                    
                    // Transactions section
                    yPos = doc.lastAutoTable.finalY + 15;
                    doc.setFontSize(14);
                    doc.text('Detail Transaksi', 20, yPos);
                    
                    // Prepare transaction data
                    const transactionData = transactions.map(transaction => {
                        const category = categories.find(cat => cat.id === transaction.category) || { name: transaction.category };
                        return [
                            Utils.formatDate(transaction.date),
                            transaction.type === 'income' ? 'Pemasukan' : 'Pengeluaran',
                            category.name,
                            transaction.description || '-',
                            Utils.formatCurrency(transaction.amount)
                        ];
                    });
                    
                    if (transactionData.length > 0) {
                        doc.autoTable({
                            startY: yPos + 5,
                            head: [['Tanggal', 'Tipe', 'Kategori', 'Keterangan', 'Jumlah']],
                            body: transactionData,
                            theme: 'grid',
                            headStyles: {
                                fillColor: [108, 99, 255],
                                textColor: [255, 255, 255],
                                fontStyle: 'bold'
                            },
                            styles: {
                                fontSize: 8,
                                cellPadding: 3
                            },
                            columnStyles: {
                                4: { halign: 'right' }
                            },
                            margin: { top: 10 }
                        });
                    } else {
                        yPos += 10;
                        doc.setFontSize(10);
                        doc.setTextColor(100, 100, 100);
                        doc.text('Tidak ada transaksi pada periode ini', 20, yPos);
                    }
                    
                    // Category breakdown for expenses (only for monthly and yearly reports)
                    if ((period === 'monthly' || period === 'yearly') && stats.expense > 0) {
                        yPos = doc.lastAutoTable ? doc.lastAutoTable.finalY + 15 : yPos + 20;
                        doc.setFontSize(14);
                        doc.setTextColor(0, 0, 0);
                        doc.text('Breakdown Pengeluaran per Kategori', 20, yPos);
                        
                        const expenseTransactions = transactions.filter(t => t.type === 'expense');
                        const expenseByCategory = {};
                        
                        expenseTransactions.forEach(t => {
                            expenseByCategory[t.category] = (expenseByCategory[t.category] || 0) + t.amount;
                        });
                        
                        const breakdownData = Object.entries(expenseByCategory).map(([categoryId, amount]) => {
                            const category = categories.find(cat => cat.id === categoryId) || { name: categoryId };
                            const percentage = ((amount / stats.expense) * 100).toFixed(1);
                            return [
                                category.name,
                                Utils.formatCurrency(amount),
                                `${percentage}%`
                            ];
                        });
                        
                        if (breakdownData.length > 0) {
                            doc.autoTable({
                                startY: yPos + 5,
                                head: [['Kategori', 'Jumlah', 'Persentase']],
                                body: breakdownData,
                                theme: 'grid',
                                headStyles: {
                                    fillColor: [108, 99, 255],
                                    textColor: [255, 255, 255],
                                    fontStyle: 'bold'
                                },
                                styles: {
                                    fontSize: 9,
                                    cellPadding: 4
                                },
                                columnStyles: {
                                    1: { halign: 'right' },
                                    2: { halign: 'right' }
                                }
                            });
                        }
                    }
                    
                    // Footer
                    const pageCount = doc.internal.getNumberOfPages();
                    for (let i = 1; i <= pageCount; i++) {
                        doc.setPage(i);
                        doc.setFontSize(8);
                        doc.setTextColor(100, 100, 100);
                        doc.text(`Halaman ${i} dari ${pageCount}`, 105, 285, { align: 'center' });
                        doc.text(`Dicetak dari MoneyTrack - ${new Date().getFullYear()}`, 105, 290, { align: 'center' });
                    }
                    
                    // Save the PDF
                    const fileName = `Laporan_Keuangan_${periodText}_${Utils.formatDate(new Date().toISOString()).replace(/\//g, '-')}.pdf`;
                    doc.save(fileName);
                    
                    Utils.showToast(`Laporan ${periodText} berhasil diunduh`, 'success');
                    
                } catch (error) {
                    console.error('Error generating PDF:', error);
                    Utils.showToast('Terjadi kesalahan saat membuat PDF', 'error');
                } finally {
                    // Hide loading
                    document.getElementById('pdf-loading').style.display = 'none';
                }
            }
        };

        // UI Functions
        const UI = {
            // Navigation
            showPage: (pageId) => {
                // Hide all pages
                document.querySelectorAll('.page-content').forEach(page => {
                    page.style.display = 'none';
                });
                
                // Show selected page
                document.getElementById(pageId).style.display = 'block';
                
                // Update active menu item
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                document.querySelector(`[data-page="${pageId}"]`).classList.add('active');
                
                // Update page title
                const titles = {
                    'dashboard-page': 'Dashboard',
                    'transactions-page': 'Transaksi',
                    'reports-page': 'Laporan',
                    'settings-page': 'Pengaturan'
                };
                
                document.getElementById('page-title').textContent = titles[pageId];
                
                // Refresh page content
                if (pageId === 'dashboard-page') {
                    UI.updateDashboard();
                } else if (pageId === 'transactions-page') {
                    UI.updateTransactions();
                } else if (pageId === 'reports-page') {
                    UI.updateReports();
                } else if (pageId === 'settings-page') {
                    UI.updateSettings();
                }
            },
            
            // Dashboard
            updateDashboard: () => {
                const stats = Transactions.getStats();
                const limitInfo = Settings.checkLimit();
                
                // Update stats
                document.getElementById('total-income').textContent = Utils.formatCurrency(stats.income);
                document.getElementById('total-expense').textContent = Utils.formatCurrency(stats.expense);
                document.getElementById('total-balance').textContent = Utils.formatCurrency(stats.balance);
                document.getElementById('daily-limit').textContent = Utils.formatCurrency(limitInfo.limit);
                document.getElementById('limit-used').textContent = Utils.formatCurrency(limitInfo.todayExpense);
                document.getElementById('limit-remaining').textContent = `Tersisa: ${Utils.formatCurrency(Math.max(0, limitInfo.limit - limitInfo.todayExpense))}`;
                document.getElementById('limit-progress').style.width = `${limitInfo.percentage}%`;
                
                // Update recent transactions
                UI.updateRecentTransactions();
                
                // Update chart
                UI.updateExpenseChart();
            },
            
            updateRecentTransactions: () => {
                const transactions = Transactions.getUserTransactions()
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 5);
                    
                const tbody = document.getElementById('recent-transactions');
                tbody.innerHTML = '';
                
                const categories = Storage.getCategories();
                
                transactions.forEach(transaction => {
                    const category = categories.find(cat => cat.id === transaction.category) || { name: transaction.category };
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${Utils.formatDate(transaction.date)}</td>
                        <td>${category.name}</td>
                        <td>${transaction.description || '-'}</td>
                        <td>
                            <span class="${transaction.type === 'income' ? 'badge badge-income' : 'badge badge-expense'}">
                                ${transaction.type === 'income' ? '+' : '-'} ${Utils.formatCurrency(transaction.amount)}
                            </span>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            },
            
            updateExpenseChart: () => {
                const ctx = document.getElementById('expense-chart').getContext('2d');
                const transactions = Transactions.getByPeriod('monthly');
                const categories = Storage.getCategories();
                
                const expenseByCategory = {};
                transactions
                    .filter(t => t.type === 'expense')
                    .forEach(t => {
                        expenseByCategory[t.category] = (expenseByCategory[t.category] || 0) + t.amount;
                    });
                
                const categoryData = Object.entries(expenseByCategory).map(([categoryId, amount]) => {
                    const category = categories.find(cat => cat.id === categoryId) || { name: categoryId, color: '#999999' };
                    return {
                        category: category.name,
                        amount: amount,
                        color: category.color
                    };
                });
                
                if (window.expenseChart) {
                    window.expenseChart.destroy();
                }
                
                if (categoryData.length > 0) {
                    window.expenseChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: categoryData.map(item => item.category),
                            datasets: [{
                                data: categoryData.map(item => item.amount),
                                backgroundColor: categoryData.map(item => item.color),
                                borderWidth: 2,
                                borderColor: '#fff'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.raw || 0;
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = Math.round((value / total) * 100);
                                            return `${label}: ${Utils.formatCurrency(value)} (${percentage}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                } else {
                    // Show empty state
                    window.expenseChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Tidak ada data'],
                            datasets: [{
                                data: [1],
                                backgroundColor: ['#e0e0e0'],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    enabled: false
                                }
                            }
                        }
                    });
                }
            },
            
            // Transactions
            updateTransactions: () => {
                const transactions = Transactions.getUserTransactions()
                    .sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                const tbody = document.getElementById('all-transactions');
                tbody.innerHTML = '';
                
                const categories = Storage.getCategories();
                
                transactions.forEach(transaction => {
                    const category = categories.find(cat => cat.id === transaction.category) || { name: transaction.category };
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${Utils.formatDate(transaction.date)}</td>
                        <td>
                            <span class="${transaction.type === 'income' ? 'badge badge-income' : 'badge badge-expense'}">
                                ${transaction.type === 'income' ? 'Pemasukan' : 'Pengeluaran'}
                            </span>
                        </td>
                        <td>${category.name}</td>
                        <td>${transaction.description || '-'}</td>
                        <td>${Utils.formatCurrency(transaction.amount)}</td>
                        <td>
                            <button class="btn btn-danger btn-sm delete-transaction" data-id="${transaction.id}">Hapus</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-transaction').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const id = e.target.getAttribute('data-id');
                        if (confirm('Apakah Anda yakin ingin menghapus transaksi ini?')) {
                            Transactions.delete(id);
                            UI.updateTransactions();
                            UI.updateDashboard();
                            Utils.showToast('Transaksi berhasil dihapus', 'success');
                        }
                    });
                });
            },
            
            // Reports
            updateReports: () => {
                const activeTab = document.querySelector('.tab.active');
                const period = activeTab.getAttribute('data-period');
                
                // Update all period reports
                ['daily', 'weekly', 'monthly', 'yearly'].forEach(p => {
                    const transactions = Transactions.getByPeriod(p);
                    const stats = Transactions.getStats(p);
                    const categories = Storage.getCategories();
                    
                    // Update stats
                    document.getElementById(`${p}-income`).textContent = Utils.formatCurrency(stats.income);
                    document.getElementById(`${p}-expense`).textContent = Utils.formatCurrency(stats.expense);
                    document.getElementById(`${p}-balance`).textContent = Utils.formatCurrency(stats.balance);
                    
                    // Update transactions table
                    const tbody = document.getElementById(`${p}-transactions`);
                    if (tbody) {
                        tbody.innerHTML = '';
                        
                        transactions.forEach(transaction => {
                            const category = categories.find(cat => cat.id === transaction.category) || { name: transaction.category };
                            const row = document.createElement('tr');
                            
                            const timeDisplay = p === 'daily' 
                                ? new Date(transaction.date).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })
                                : Utils.formatDate(transaction.date);
                                
                            row.innerHTML = `
                                <td>${timeDisplay}</td>
                                <td>
                                    <span class="${transaction.type === 'income' ? 'badge badge-income' : 'badge badge-expense'}">
                                        ${transaction.type === 'income' ? 'Pemasukan' : 'Pengeluaran'}
                                    </span>
                                </td>
                                <td>${category.name}</td>
                                <td>${transaction.description || '-'}</td>
                                <td>${Utils.formatCurrency(transaction.amount)}</td>
                            `;
                            tbody.appendChild(row);
                        });
                    }
                    
                    // Update chart
                    UI.updateReportChart(p);
                });
                
                // Update report title
                const titles = {
                    'daily': 'Laporan Harian',
                    'weekly': 'Laporan Mingguan',
                    'monthly': 'Laporan Bulanan',
                    'yearly': 'Laporan Tahunan'
                };
                document.getElementById('report-title').textContent = titles[period];
            },
            
            updateReportChart: (period) => {
                const ctx = document.getElementById(`${period}-chart`);
                if (!ctx) return;
                
                const transactions = Transactions.getByPeriod(period);
                const categories = Storage.getCategories();
                
                // For daily report, show hourly breakdown
                if (period === 'daily') {
                    const hourlyData = {};
                    for (let i = 0; i < 24; i++) {
                        hourlyData[i] = { income: 0, expense: 0 };
                    }
                    
                    transactions.forEach(t => {
                        const hour = new Date(t.date).getHours();
                        if (t.type === 'income') {
                            hourlyData[hour].income += t.amount;
                        } else {
                            hourlyData[hour].expense += t.amount;
                        }
                    });
                    
                    const hours = Object.keys(hourlyData);
                    const incomeData = hours.map(h => hourlyData[h].income);
                    const expenseData = hours.map(h => hourlyData[h].expense);
                    
                    if (window[`${period}Chart`]) {
                        window[`${period}Chart`].destroy();
                    }
                    
                    window[`${period}Chart`] = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: hours.map(h => `${h}:00`),
                            datasets: [
                                {
                                    label: 'Pemasukan',
                                    data: incomeData,
                                    backgroundColor: '#4CAF50',
                                    borderColor: '#4CAF50',
                                    borderWidth: 1
                                },
                                {
                                    label: 'Pengeluaran',
                                    data: expenseData,
                                    backgroundColor: '#F44336',
                                    borderColor: '#F44336',
                                    borderWidth: 1
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    stacked: false
                                },
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return Utils.formatCurrency(value);
                                        }
                                    }
                                }
                            }
                        }
                    });
                } else {
                    // For other periods, show category breakdown for expenses
                    const expenseByCategory = {};
                    transactions
                        .filter(t => t.type === 'expense')
                        .forEach(t => {
                            expenseByCategory[t.category] = (expenseByCategory[t.category] || 0) + t.amount;
                        });
                    
                    const categoryData = Object.entries(expenseByCategory).map(([categoryId, amount]) => {
                        const category = categories.find(cat => cat.id === categoryId) || { name: categoryId, color: '#999999' };
                        return {
                            category: category.name,
                            amount: amount,
                            color: category.color
                        };
                    });
                    
                    if (window[`${period}Chart`]) {
                        window[`${period}Chart`].destroy();
                    }
                    
                    if (categoryData.length > 0) {
                        window[`${period}Chart`] = new Chart(ctx, {
                            type: 'pie',
                            data: {
                                labels: categoryData.map(item => item.category),
                                datasets: [{
                                    data: categoryData.map(item => item.amount),
                                    backgroundColor: categoryData.map(item => item.color),
                                    borderWidth: 2,
                                    borderColor: '#fff'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        position: 'bottom'
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                const label = context.label || '';
                                                const value = context.raw || 0;
                                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                                const percentage = Math.round((value / total) * 100);
                                                return `${label}: ${Utils.formatCurrency(value)} (${percentage}%)`;
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    } else {
                        // Show empty state
                        window[`${period}Chart`] = new Chart(ctx, {
                            type: 'pie',
                            data: {
                                labels: ['Tidak ada data'],
                                datasets: [{
                                    data: [1],
                                    backgroundColor: ['#e0e0e0'],
                                    borderWidth: 0
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    },
                                    tooltip: {
                                        enabled: false
                                    }
                                }
                            }
                        });
                    }
                }
            },
            
            // Settings
            updateSettings: () => {
                const currentUser = Storage.getCurrentUser();
                const dailyLimit = Settings.getDailyLimit();
                
                document.getElementById('profile-name').value = currentUser.name;
                document.getElementById('profile-username').value = currentUser.username;
                document.getElementById('profile-email').value = currentUser.email;
                document.getElementById('daily-limit-input').value = dailyLimit;
                
                // Render categories
                Categories.renderCategories();
            }
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            // Check if user is logged in
            const currentUser = Storage.getCurrentUser();
            
            if (currentUser) {
                // Show dashboard
                document.getElementById('auth-page').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                
                // Update user info
                document.getElementById('user-name').textContent = currentUser.name;
                document.getElementById('user-avatar').textContent = currentUser.name.charAt(0).toUpperCase();
                
                // Load categories to expense dropdown
                Categories.loadCategoriesToSelect();
                
                // Initialize dashboard
                UI.updateDashboard();
            } else {
                // Show auth page
                document.getElementById('auth-page').style.display = 'flex';
                document.getElementById('dashboard').style.display = 'none';
            }
            
            // Auth event listeners
            document.getElementById('show-register').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('register-form').style.display = 'block';
            });
            
            document.getElementById('show-login').addEventListener('click', (e) => {
                e.preventDefault();
                document.getElementById('register-form').style.display = 'none';
                document.getElementById('login-form').style.display = 'block';
            });
            
            document.getElementById('login-btn').addEventListener('click', () => {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                const result = Auth.login(email, password);
                
                if (result.success) {
                    Utils.showToast('Login berhasil!', 'success');
                    setTimeout(() => window.location.reload(), 1000);
                } else {
                    Utils.showToast(result.message, 'error');
                }
            });
            
            document.getElementById('register-btn').addEventListener('click', () => {
                const name = document.getElementById('register-name').value;
                const username = document.getElementById('register-username').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const confirmPassword = document.getElementById('register-confirm').value;
                
                const result = Auth.register(name, username, email, password, confirmPassword);
                
                if (result.success) {
                    Utils.showToast('Pendaftaran berhasil!', 'success');
                    setTimeout(() => window.location.reload(), 1000);
                } else {
                    Utils.showToast(result.message, 'error');
                }
            });
            
            // Dashboard event listeners
            document.getElementById('logout-btn').addEventListener('click', (e) => {
                e.preventDefault();
                if (confirm('Apakah Anda yakin ingin keluar?')) {
                    Auth.logout();
                }
            });
            
            // Navigation
            document.querySelectorAll('.menu-item').forEach(item => {
                if (item.id !== 'logout-btn') {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const pageId = item.getAttribute('data-page');
                        UI.showPage(pageId);
                    });
                }
            });
            
            // Transaction forms
            document.querySelectorAll('.form-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    // Update active tab
                    document.querySelectorAll('.form-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show corresponding form
                    const formId = tab.getAttribute('data-form');
                    document.querySelectorAll('.transaction-form').forEach(form => {
                        form.classList.remove('active');
                    });
                    document.getElementById(formId).classList.add('active');
                });
            });
            
            // Add transaction buttons
            document.getElementById('add-income-btn').addEventListener('click', () => {
                UI.showPage('transactions-page');
                document.querySelector('[data-form="income-form"]').click();
            });
            
            document.getElementById('add-expense-btn').addEventListener('click', () => {
                UI.showPage('transactions-page');
                document.querySelector('[data-form="expense-form"]').click();
            });
            
            // Category management
            document.getElementById('manage-categories-btn').addEventListener('click', () => {
                UI.showPage('settings-page');
            });
            
            document.getElementById('add-category-btn').addEventListener('click', () => {
                Categories.openAddModal();
            });
            
            document.getElementById('category-modal-close').addEventListener('click', () => {
                Categories.closeModal();
            });
            
            document.getElementById('save-category').addEventListener('click', () => {
                Categories.saveCategory();
            });
            
            // Save transactions
            document.getElementById('save-income').addEventListener('click', () => {
                const amount = document.getElementById('income-amount').value;
                const source = document.getElementById('income-source').value;
                const date = document.getElementById('income-date').value;
                const description = document.getElementById('income-description').value;
                
                if (!amount || !date) {
                    Utils.showToast('Jumlah dan tanggal harus diisi', 'error');
                    return;
                }
                
                Transactions.add('income', amount, source, date, description);
                Utils.showToast('Pemasukan berhasil ditambahkan', 'success');
                
                // Reset form
                document.getElementById('income-amount').value = '';
                document.getElementById('income-date').value = '';
                document.getElementById('income-description').value = '';
                
                // Update UI
                UI.updateDashboard();
                UI.updateTransactions();
            });
            
            document.getElementById('save-expense').addEventListener('click', () => {
                const amount = document.getElementById('expense-amount').value;
                const category = document.getElementById('expense-category').value;
                const date = document.getElementById('expense-date').value;
                const description = document.getElementById('expense-description').value;
                
                if (!amount || !date) {
                    Utils.showToast('Jumlah dan tanggal harus diisi', 'error');
                    return;
                }
                
                // Check daily limit
                const limitInfo = Settings.checkLimit();
                const newTotal = limitInfo.todayExpense + parseInt(amount);
                
                if (limitInfo.limit > 0 && newTotal > limitInfo.limit) {
                    if (!confirm(`Pengeluaran ini akan melebihi limit harian Anda. Lanjutkan?`)) {
                        return;
                    }
                }
                
                Transactions.add('expense', amount, category, date, description);
                Utils.showToast('Pengeluaran berhasil ditambahkan', 'success');
                
                // Reset form
                document.getElementById('expense-amount').value = '';
                document.getElementById('expense-date').value = '';
                document.getElementById('expense-description').value = '';
                
                // Update UI
                UI.updateDashboard();
                UI.updateTransactions();
                
                // Check limit after adding expense
                const newLimitInfo = Settings.checkLimit();
                if (!newLimitInfo.withinLimit) {
                    Utils.showToast('Anda telah melebihi limit pengeluaran harian!', 'warning');
                } else if (newLimitInfo.percentage > 80) {
                    Utils.showToast('Pengeluaran Anda mendekati limit harian!', 'warning');
                }
            });
            
            // Report tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    // Update active tab
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show corresponding report
                    const period = tab.getAttribute('data-period');
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${period}-report`).classList.add('active');
                    
                    // Update report content
                    UI.updateReports();
                });
            });
            
            // Export PDF
            document.getElementById('export-pdf').addEventListener('click', () => {
                const activeTab = document.querySelector('.tab.active');
                const period = activeTab.getAttribute('data-period');
                PDFExport.generatePDF(period);
            });
            
            // Settings
            document.getElementById('save-limit').addEventListener('click', () => {
                const limit = document.getElementById('daily-limit-input').value;
                
                if (!limit || limit <= 0) {
                    Utils.showToast('Limit harus lebih dari 0', 'error');
                    return;
                }
                
                Settings.setDailyLimit(limit);
                Utils.showToast('Limit harian berhasil disimpan', 'success');
                UI.updateDashboard();
            });
            
            document.getElementById('save-profile').addEventListener('click', () => {
                const name = document.getElementById('profile-name').value;
                const username = document.getElementById('profile-username').value;
                const email = document.getElementById('profile-email').value;
                
                if (!name || !username || !email) {
                    Utils.showToast('Semua field harus diisi', 'error');
                    return;
                }
                
                if (!Utils.validateEmail(email)) {
                    Utils.showToast('Format email tidak valid', 'error');
                    return;
                }
                
                // Update current user
                const currentUser = Storage.getCurrentUser();
                currentUser.name = name;
                currentUser.username = username;
                currentUser.email = email;
                
                // Update in storage
                Storage.setCurrentUser(currentUser);
                
                // Update users list
                const users = Storage.getUsers();
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex] = currentUser;
                    Storage.setUsers(users);
                }
                
                // Update UI
                document.getElementById('user-name').textContent = currentUser.name;
                document.getElementById('user-avatar').textContent = currentUser.name.charAt(0).toUpperCase();
                
                Utils.showToast('Profil berhasil diperbarui', 'success');
            });
            
            // Dark mode toggle
            document.getElementById('toggle-dark').addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                const isDarkMode = document.body.classList.contains('dark-mode');
                localStorage.setItem('darkMode', isDarkMode);
                
                Utils.showToast(`Mode ${isDarkMode ? 'gelap' : 'terang'} diaktifkan`, 'success');
            });
            
            // Check for saved dark mode preference
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
            }
            
            // Mobile sidebar toggle
            document.getElementById('toggle-sidebar').addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('open');
            });
            
            // Set default dates to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('income-date').value = today;
            document.getElementById('expense-date').value = today;
        });
    </script>
</body>
</html>